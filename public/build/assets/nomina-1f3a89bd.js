import{$ as T}from"./jquery-2823516c.js";import"./_commonjsHelpers-725317a4.js";window.$=window.jQuery=T;(function(e){function s(o){if(o==null)return 0;let a=String(o).trim();if(a==="")return 0;a=a.replace(/\s/g,""),a.indexOf(",")>-1&&a.indexOf(".")>-1&&a.indexOf(",")>a.indexOf(".")?a=a.replace(/\./g,"").replace(",","."):a.indexOf(",")>-1&&a.indexOf(".")===-1?a=a.replace(",","."):a=a.replace(",","");const n=parseFloat(a);return isNaN(n)?0:n}function v(o){o=Number(o||0);const a=o<0;o=Math.abs(o);const n=o.toFixed(2).split(".");let d=n[0];const r=n[1];return d=d.replace(/\B(?=(\d{3})+(?!\d))/g,"."),(a?"-":"")+d+","+r}function h(o,a="success",n=3e3){const d=document.getElementById("toastContainer");if(!d)return;const r=document.createElement("div");r.className=`
            flex items-center p-4 w-full max-w-xs text-gray-500 bg-white rounded-lg shadow dark:bg-gray-800 dark:text-gray-300
            border-l-4 ${a==="success"?"border-green-500":"border-red-500"}
            animate-slide-in
        `,r.innerHTML=`
            <div class="ml-3 text-sm font-normal">${o}</div>
            <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg text-sm p-1.5 inline-flex items-center dark:bg-gray-800 dark:hover:text-white">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
            </button>
        `,r.querySelector("button").addEventListener("click",()=>r.remove()),d.appendChild(r),setTimeout(()=>r.remove(),n)}function y(){let o=0;e("#tabla_remunerativos tbody tr").each(function(){const t=e(this),f=t.find("input.line-cantidad"),c=t.find(".line-valor"),u=t.find(".line-importe");let p=0;f.length?p=s(f.val()):p=s(t.data("cantidad")||0);let l=0;c.length&&(l=s(c.data("valor")??c.text()));const i=parseFloat((p*l).toFixed(2))||0;u.length&&(u.attr("data-raw",i),u.text(v(i))),o+=i}),e("#subtotal_remunerativo").text(v(o));let a=0;e("#tabla_descuentos tbody tr.line-desc").each(function(){const t=e(this),f=t.find("input"),c=f.length?s(f.val()):0,u=s(t.data("fixed-importe")||t.find(".line-desc-importe").data("raw")||0);let p=0;c>0?p=parseFloat((o*(c/100)).toFixed(2)):p=u;const l=t.find(".line-desc-importe");l.length&&(l.attr("data-raw",p),l.text(v(p))),a+=p}),e("#total_descuentos").text("- "+v(a));const n=parseFloat((o-a).toFixed(2))||0;e("#subtotal2").text(v(n));let d=0;e("#tabla_no_remunerativos tbody tr").each(function(){const t=e(this),f=t.find("input.line-cantidad"),c=t.find(".line-valor"),u=t.find(".line-importe");let p=f.length?s(f.val()):s(t.data("cantidad")||0),l=c.length?s(c.data("valor")??c.text()):0;const i=parseFloat((p*l).toFixed(2))||0;u.length&&(u.attr("data-raw",i),u.text(v(i))),d+=i}),e("#subtotal_no_remunerativo").text(v(d+n));const r=parseFloat((n+d).toFixed(2))||0;e("#total_depositar").text(v(r)),window._sueldo_totales={subtotal_remunerativo:o,total_descuentos:a,subtotal2:n,subtotal_no_remunerativo:d,neto:r};const x=s(e("#otros_adelantos").val()),_=s(e("#otros_celular").val()),F=s(e("#otros_gastos").val()),g=parseFloat((x+_+F).toFixed(2))||0;e("#total_otros_descuentos").text("- "+v(g));const m=parseFloat((r-g).toFixed(2))||0;return e("#total_depositar").text(v(m)),window._sueldo_totales={subtotal_remunerativo:o,total_descuentos:a,subtotal2:n,subtotal_no_remunerativo:d,neto:r,otros_descuentos:g,neto_final:m},window._sueldo_totales}async function O(){const o=e("#guardarNominaBtn");let a=o.text();try{typeof window.recalcularTodo=="function"&&window.recalcularTodo();const n=window._sueldo_totales||{},d=s(e("#otros_adelantos").val()),r=s(e("#otros_celular").val()),x=s(e("#otros_gastos").val());n.otros_descuentos=parseFloat((d+r+x).toFixed(2))||0,n.neto_final=parseFloat(((n.neto||0)-n.otros_descuentos).toFixed(2))||0;const _=[];e("#tabla_remunerativos tbody tr").each(function(){const t=e(this),f=t.data("line-id")??null,c=t.find("td").first().text().trim();if(c.toLowerCase()==="sueldo básico")return;const u=t.find("input.line-cantidad").val(),p=parseFloat(u||0);let l=t.find(".line-valor").data("valor"),i=0;typeof l<"u"&&l!==null?i=s(l):i=s(t.find(".line-valor").text()),i=parseFloat(i)||0;let b=t.find(".line-importe").attr("data-raw"),w=0;typeof b<"u"&&b!==null&&b!==""?w=parseFloat(b)||0:w=parseFloat(s(t.find(".line-importe").text()))||0,_.push({id:f,tipo:"remunerativo",nombre:c,cantidad:p,valor_unitario:i,importe:w})}),e("#tabla_descuentos tbody tr.line-desc").each(function(){const t=e(this),f=t.data("line-id")??null,c=t.find("td").first().text().trim(),u=t.find("input").val(),p=u===""||typeof u>"u"?null:parseFloat(s(u))||null;let l=t.find(".line-desc-importe").attr("data-raw"),i=0;typeof l<"u"&&l!==null&&l!==""?i=parseFloat(l)||0:i=parseFloat(s(t.find(".line-desc-importe").text()))||0,_.push({id:f,tipo:"descuento",nombre:c,porcentaje:p,importe:i})}),e("#tabla_no_remunerativos tbody tr").each(function(){const t=e(this),f=t.data("line-id")??null,c=t.find("td").first().text().trim(),u=t.find("input.line-cantidad").val(),p=parseFloat(u||0);let l=t.find(".line-valor").data("valor"),i=0;typeof l<"u"&&l!==null?i=s(l):i=s(t.find(".line-valor").text()),i=parseFloat(i)||0;let b=t.find(".line-importe").attr("data-raw"),w=0;typeof b<"u"&&b!==null&&b!==""?w=parseFloat(b)||0:w=parseFloat(s(t.find(".line-importe").text()))||0,_.push({id:f,tipo:"no_remunerativo",nombre:c,cantidad:p,valor_unitario:i,importe:w})});const F={lineas:_,totales:n,extras:{adelantos:d,celular:r,gastos:x}};let g=null;window.SUELDO_APP&&window.SUELDO_APP.guardarUrl?g=window.SUELDO_APP.guardarUrl:e("#sueldo-app").length&&e("#sueldo-app").data("guardar-url")?g=e("#sueldo-app").data("guardar-url"):g="/admin/nominas/guardar",o.prop("disabled",!0),o.text("Guardando…");const m=await axios.post(g,F,{headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")||"","Content-Type":"application/json"},timeout:2e4});m&&m.data&&m.data.success?h(m.data.message||"Nómina guardada correctamente.","success"):(console.error("Respuesta servidor:",m.data),h("No se pudo guardar la nómina: "+(m.data&&m.data.message?m.data.message:"Error desconocido."),"error"))}catch(n){if(n.response&&n.response.status===422){const d=n.response.data||{},r=d.errors||d.message||n.response.data,x=r&&typeof r=="object"?Object.keys(r)[0]:null,_=x?Array.isArray(r[x])?r[x][0]:r[x]:JSON.stringify(r);h("Error de validación: "+_,"error")}else console.error("Error guardando nómina:",n),h("Error al guardar la nómina. Revisa la consola.","error")}finally{o.prop("disabled",!1),o.text(a||"Guardar Nómina")}}e(document).on("click","#guardarNominaBtn",function(o){o.preventDefault(),O()});function N(o,a){let n;return function(){clearTimeout(n);const d=arguments,r=this;n=setTimeout(()=>o.apply(r,d),a)}}e(document).ready(function(){y(),e(document).on("input","#tabla_remunerativos input.line-cantidad, #tabla_no_remunerativos input.line-cantidad",N(function(){y()},250)),e(document).on("input","#tabla_descuentos tbody tr.line-desc input",N(function(){y()},250)),e(document).on("input",".input-otros-descuentos",function(){y()})}),window.recalcularTodo=y})(jQuery);
